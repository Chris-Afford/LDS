<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <style>
        body { background-color: #121212; color: white; font-family: Arial; }
        .club { margin: 10px 0; }
        .club-name { cursor: pointer; font-weight: bold; }
        .venues { display: none; margin-left: 20px; }
        .venue-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        button { margin-left: 8px; }
        .popup-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center;
        }
        .popup { background: #222; padding: 20px; border-radius: 8px; }
        .popup input, .popup select { margin: 5px 0; }
    </style>
    <script>
        function toggleVenues(id) {
            const el = document.getElementById('venues-' + id);
            const arrow = document.getElementById('arrow-' + id);
            if (el.style.display === 'block') {
                el.style.display = 'none';
                arrow.innerHTML = '▶';
            } else {
                el.style.display = 'block';
                arrow.innerHTML = '▼';
            }
        }

        function confirmDeleteVenue(venueId, venueName) {
            if (confirm("Are you sure you want to delete venue '" + venueName + "'?")) {
                fetch('/admin/delete_venue', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: 'venue_id=' + venueId
                }).then(() => location.reload());
            }
        }

        function showPasswordPopup() {
            document.getElementById("password-popup-bg").style.display = "flex";
        }

        function closePasswordPopup() {
            document.getElementById("password-popup-bg").style.display = "none";
        }
    </script>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <button onclick="showPasswordPopup()" style="float: right;">Change Club Password</button>

    {% for club in clubs %}
        <div class="club">
            <span id="arrow-{{ club.id }}" onclick="toggleVenues({{ club.id }})">▶</span>
            <span class="club-name" onclick="toggleVenues({{ club.id }})">{{ club.name }} ({{ club.username }})</span>
            <div class="venues" id="venues-{{ club.id }}">
                {% for venue in venues %}
                    {% if venue.club_id == club.id %}
                        <div class="venue-item">
                            <span>{{ venue.name }}</span>
                            <button onclick="confirmDeleteVenue({{ venue.id }}, '{{ venue.name }}')">Delete</button>
                        </div>
                    {% endif %}
                {% endfor %}
                <form method="post" action="/admin/add_venue">
                    <input type="hidden" name="club_id" value="{{ club.id }}">
                    <input type="text" name="venue_name" placeholder="New Venue Name" required>
                    <button type="submit">Add Venue</button>
                </form>
            </div>
        </div>
    {% endfor %}

    <h2>Add New Club</h2>
    <form method="post" action="/admin/add_club">
        <input type="text" name="name" placeholder="Club Name" required>
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Add Club</button>
    </form>

    <!-- Password Popup -->
    <div id="password-popup-bg" class="popup-bg">
        <div class="popup">
            <form method="post" action="/admin/update_password">
                <h3>Change Club Password</h3>
                <select name="club_id" required>
                    {% for club in clubs %}
                        <option value="{{ club.id }}">{{ club.name }}</option>
                    {% endfor %}
                </select><br>
                <input type="password" name="new_password" placeholder="New Password" required><br>
                <button type="submit">Apply</button>
                <button type="button" onclick="closePasswordPopup()">Cancel</button>
            </form>
        </div>
    </div>
</body>
</html>
